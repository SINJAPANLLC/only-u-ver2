Last login: Tue Oct 28 15:54:49 on ttys106
kazuyaotani@kazuya-MacBook-Air-2 ~ % ssh root@212.85.24.206
root@212.85.24.206's password: 
Welcome to Ubuntu 24.04.3 LTS (GNU/Linux 6.8.0-85-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/pro

 System information as of Tue Oct 28 07:09:44 UTC 2025

  System load:  0.0               Processes:             112
  Usage of /:   4.4% of 95.82GB   Users logged in:       0
  Memory usage: 9%                IPv4 address for eth0: 212.85.24.206
  Swap usage:   0%                IPv6 address for eth0: 2a02:4780:59:cc86::1

 * Strictly confined Kubernetes makes edge and IoT secure. Learn how MicroK8s
   just raised the bar for easy, resilient and secure K8s cluster deployment.

   https://ubuntu.com/engage/secure-kubernetes-at-the-edge

Expanded Security Maintenance for Applications is not enabled.

0 updates can be applied immediately.

Enable ESM Apps to receive additional future security updates.
See https://ubuntu.com/esm or run: sudo pro status


1 updates could not be installed automatically. For more details,
see /var/log/unattended-upgrades/unattended-upgrades.log

*** System restart required ***
Last login: Tue Oct 28 07:01:28 2025 from 212.85.24.206
root@srv1087935:~# cd /var/www/only-u
root@srv1087935:/var/www/only-u# ls -la firebase-admin-key.json
ls: cannot access 'firebase-admin-key.json': No such file or directory
root@srv1087935:/var/www/only-u# cat firebase-admin-key.json
cat: firebase-admin-key.json: No such file or directory
root@srv1087935:/var/www/only-u# cat > firebase-admin-key.json << 'EOF'
{
  "type": "service_account",
  "project_id": "onlyu1020-c6696",
  "private_key_id": "01659e1ce88ab599b06b76b67ace66183a4c97db",
  "private_key": "-----BEGIN PRIVATE KEY-----\nMIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQCyMXpsWJhWgYwu\n7qFVs7M6ZF3H2ExKKPPVHuiBSSAL3qHMltlX8Bqp7EUztUwH28p9rZcttdJq43PN\ndHHImKBnrU6FrYNWUkZGDBQVkMFR4a0OL6J5JpEoqh8tx/EqQAtPHfNtBK/LXwWQ\n6Z34TsueYT2FFcsePyPDaX14nPhSPHQlKmmtZiaM64s1hw8hSqhXe8NUnFzaX2J9\nw9DSAAnMxvgYa2dqfFoOAnQZssgWxNBzHgBqMckN+bMRNsjTPPyjtEATF/uESoM7\nc2YDZRvZS3rTkHyfeJeA8BREe528INtms6RrEf/fV3vfU7rOC43eK0H40i3CTe1Q\n8plyQn3JAgMBAAECggEAT1Y+Np0ffmyBeKfghyLSKq5jHsZL+TzQi1QOmvlu3joK\neeez7zZE+ODsUsBmkJ0oQ9qVE9H/VH3eolw1COYDjQWZj2UYs8c/6JIaIxvnJsi+\n3zEQOraULLHJ3f1Gf9Qx9NDV//T1PCwbc1DAd7zFZcfPt0BjxhzAlJGUPq5M1Xe6\n3IwDmGspOs+JT6JnH2ULQFfMQsR2t7P2NHR7bxw1mPjDXnnTmuXQAChr7kuXc4AQ\nC5OIfR3Oay+lJl41kiE3NsXUZNciKB8TLE2plUIGV292y32ju67ApHoxQPiOKarQ\nSqUJCCBddfs2frMjuW1zGqgEgA6R2baddl9aqyxqbQKBgQD3E7USYRsYtwjMC3pV\nf+qkEqmIkFKn0HbrAsb2640uuZ6LiXqQkPeDqImI3OTTsm089GAmjALtnntyRR61\nIORSSVOtfVEBzbyqzDWaVelqVObnZw9DCNtshU4ATOnnGDFHq5BXmZ9dpS4wQl4p\nlek+qGJbyzdaLlKBjbokRDgYMwKBgQC4oOwxhkvmPcGm+7GChrYNVBGqOm7yNuIt\nTmCmYtvrkTqd/pt5GWUEYxCRIMlOlQD6Qu/S7mKN555TahL4qambKpRF4cAkFif5\nexHFgrmTclJBQtPBMktTk1qBtmbc4b6xHjRigTGXUZtWSEpA5L2zJbgzsNZR53vK\n0qVV7tqGEwKBgE2otRY0zWaESVCRHv92uFKfxwe0jTZP8MDHW7BKs1KHZ0zmhk6g\nMhwAwlHxVD8x6uHo0bvr8BOt55EwJom57+npQFLce7S8bNumWgbLkBUq4HTFUOe6\nBfXjJHQ1uKM5WGv1geX21D+D5rOmeKBLjUdzd47wndJLkwVDfcleY98/AoGACuCI\nKb7Et/LJduH7KjpvfUeHpuS8Zo6vMoYckZDfbfhnYKmAVVkWp3SCpFovIe8LWLMa\n1+1tZvjPThDAv1+Xe2m9xIQxQq7/eeYzPNSfxD0G9YtPWGFzKKBUw7GQS9EM3/hs\nk6US29xV73Zg0YPoXSaKvJjdd4PQujlAvlhNDXsCgYEA3O62qvh4U9yPRDKs8DJG\n7cpz04CneWEdp0ERAStXPv/YwGvS29kHB06sUGkMyvyUhnKfrzWAOXhdnRnY0EtO\n+dh7ZMNVTS/jhZh3SshT7Nj/TNsfGYLQoqA+sEiikUpks8wjrEOFuniverse_domain": "googleapis.com"6.iam.gserviceaccount.com",etadata/x509/fir
root@srv1087935:/var/www/only-u# # 権限を設定
chmod 600 firebase-admin-key.json

# 確認
ls -la firebase-admin-key.json

# PM2を再起動
pm2 restart all

# ログで確認
sleep 3
pm2 logs only-u --lines 20
-rw------- 1 root root 2385 Oct 28 07:12 firebase-admin-key.json
Use --update-env to update environment variables
[PM2] Applying action restartProcessId on app [all](ids: [ 0 ])
[PM2] [only-u](0) ✓
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ only-u             │ cluster  │ 1    │ online    │ 0%       │ 41.0mb   │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
[TAILING] Tailing last 20 lines for [only-u] process (change the value with --lines option)
/var/www/only-u/logs/error.log last 20 lines:
0|only-u   |     at async Upload.makeRequest (/var/www/only-u/node_modules/@google-cloud/storage/build/cjs/src/resumable-upload.js:769:21)
0|only-u   |     at async uri.retries (/var/www/only-u/node_modules/@google-cloud/storage/build/cjs/src/resumable-upload.js:435:29)
0|only-u   |     at async Upload.createURIAsync (/var/www/only-u/node_modules/@google-cloud/storage/build/cjs/src/resumable-upload.js:432:21)
0|only-u   | 2025-10-28 06:52:18 +00:00: Error uploading file: Error: Failed to upload file: Could not load the default credentials. Browse to https://cloud.google.com/docs/authentication/getting-started for more information.
0|only-u   |     at ObjectStorageService.uploadFile (file:///var/www/only-u/dist/index.js:112:17)
0|only-u   |     at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
0|only-u   |     at async file:///var/www/only-u/dist/index.js:738:28
0|only-u   | 2025-10-28 06:59:28 +00:00: [uploadFile] Failed to upload to Firebase Storage: Error: Could not load the default credentials. Browse to https://cloud.google.com/docs/authentication/getting-started for more information.
0|only-u   |     at GoogleAuth.getApplicationDefaultAsync (/var/www/only-u/node_modules/google-auth-library/build/src/auth/googleauth.js:287:15)
0|only-u   |     at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
0|only-u   |     at async GoogleAuth._GoogleAuth_determineClient (/var/www/only-u/node_modules/google-auth-library/build/src/auth/googleauth.js:834:32)
0|only-u   |     at async GoogleAuth.getClient (/var/www/only-u/node_modules/google-auth-library/build/src/auth/googleauth.js:698:20)
0|only-u   |     at async GoogleAuth.request (/var/www/only-u/node_modules/google-auth-library/build/src/auth/googleauth.js:753:24)
0|only-u   |     at async Upload.makeRequest (/var/www/only-u/node_modules/@google-cloud/storage/build/cjs/src/resumable-upload.js:769:21)
0|only-u   |     at async uri.retries (/var/www/only-u/node_modules/@google-cloud/storage/build/cjs/src/resumable-upload.js:435:29)
0|only-u   |     at async Upload.createURIAsync (/var/www/only-u/node_modules/@google-cloud/storage/build/cjs/src/resumable-upload.js:432:21)
0|only-u   | 2025-10-28 06:59:28 +00:00: Error uploading file: Error: Failed to upload file: Could not load the default credentials. Browse to https://cloud.google.com/docs/authentication/getting-started for more information.
0|only-u   |     at ObjectStorageService.uploadFile (file:///var/www/only-u/dist/index.js:112:17)
0|only-u   |     at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
0|only-u   |     at async file:///var/www/only-u/dist/index.js:738:28

/var/www/only-u/logs/out.log last 20 lines:
0|only-u   | 2025-10-28 06:59:28 +00:00: 6:59:28 AM [express] POST /api/objects/upload 500 in 69ms :: {"error":"Internal server error"}
0|only-u   | 2025-10-28 07:11:17 +00:00: Proxy request for: public 75b0d1f5-5085-40dc-aa32-0cc1ed1f8c78.MP4 Object path: /objects/75b0d1f5-5085-40dc-aa32-0cc1ed1f8c78.MP4 Range: bytes=0-
0|only-u   | 2025-10-28 07:11:17 +00:00: [getObjectEntityFile] entityId: 75b0d1f5-5085-40dc-aa32-0cc1ed1f8c78.MP4
0|only-u   | 2025-10-28 07:11:17 +00:00: [Proxy] Downloading file from Firebase Storage: public/75b0d1f5-5085-40dc-aa32-0cc1ed1f8c78.MP4
0|only-u   | 2025-10-28 07:11:19 +00:00: 7:11:19 AM [express] POST /api/create-subscription-payment-intent 200 in 613ms :: {"clientSecret":"p…
0|only-u   | 2025-10-28 07:11:19 +00:00: [Proxy] Downloaded successfully, size: 6093542 bytes
0|only-u   | 2025-10-28 07:11:19 +00:00: 7:11:19 AM [express] GET /api/proxy/public/75b0d1f5-5085-40dc-aa32-0cc1ed1f8c78.MP4 206 in 2948ms
0|only-u   | 2025-10-28 07:11:20 +00:00: Proxy request for: public 75b0d1f5-5085-40dc-aa32-0cc1ed1f8c78.MP4 Object path: /objects/75b0d1f5-5085-40dc-aa32-0cc1ed1f8c78.MP4 Range: bytes=6029312-
0|only-u   | 2025-10-28 07:11:20 +00:00: [getObjectEntityFile] entityId: 75b0d1f5-5085-40dc-aa32-0cc1ed1f8c78.MP4
0|only-u   | 2025-10-28 07:11:20 +00:00: [Proxy] Downloading file from Firebase Storage: public/75b0d1f5-5085-40dc-aa32-0cc1ed1f8c78.MP4
0|only-u   | 2025-10-28 07:11:23 +00:00: [Proxy] Downloaded successfully, size: 6093542 bytes
0|only-u   | 2025-10-28 07:11:23 +00:00: 7:11:23 AM [express] GET /api/proxy/public/75b0d1f5-5085-40dc-aa32-0cc1ed1f8c78.MP4 206 in 2894ms
0|only-u   | 2025-10-28 07:11:23 +00:00: Proxy request for: public 75b0d1f5-5085-40dc-aa32-0cc1ed1f8c78.MP4 Object path: /objects/75b0d1f5-5085-40dc-aa32-0cc1ed1f8c78.MP4 Range: bytes=65536-
0|only-u   | 2025-10-28 07:11:23 +00:00: [getObjectEntityFile] entityId: 75b0d1f5-5085-40dc-aa32-0cc1ed1f8c78.MP4
0|only-u   | 2025-10-28 07:11:23 +00:00: [Proxy] Downloading file from Firebase Storage: public/75b0d1f5-5085-40dc-aa32-0cc1ed1f8c78.MP4
0|only-u   | 2025-10-28 07:11:26 +00:00: [Proxy] Downloaded successfully, size: 6093542 bytes
0|only-u   | 2025-10-28 07:11:26 +00:00: 7:11:26 AM [express] GET /api/proxy/public/75b0d1f5-5085-40dc-aa32-0cc1ed1f8c78.MP4 206 in 2670ms
0|only-u   | 2025-10-28 07:12:44 +00:00: 🔑 Initializing Firebase with service account key...
0|only-u   | 2025-10-28 07:12:44 +00:00: ✅ Firebase initialized with service account
0|only-u   | 2025-10-28 07:12:44 +00:00: 7:12:44 AM [express] serving on port 5000


